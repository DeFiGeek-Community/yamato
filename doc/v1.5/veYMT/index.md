# veYMT Token

## 概要

veYMT Token は、YMT トークンをロックすることで得られる、ERC-20 互換のトークンです。ただし、このトークンは`transfer()`機能を持ちません。投票用のエスクロートークンとして機能し、ロックされたトークンには時間に応じた重みが付与されます。

#### 参考

- [Curve DAO: Vote-Escrowed CRV](https://etherscan.io/address/0x5f3b5dfeb7b28cdbd7faba78963ee202a494e2a2#readContract)
- [Curve VotingEscrow Contract](https://curve.readthedocs.io/dao-vecrv.html)
- [The Curve DAO: Liquidity Gauges and Minting CRV](https://curve.readthedocs.io/dao-gauges.html)
- [LiquidityGaugeV6 Contract](https://github.com/curvefi/tricrypto-ng/blob/main/contracts/main/LiquidityGauge.vy)
  以下は、提供された Solidity コード「veYMT Token」のためのドキュメントです。このドキュメントは、以前の「Token Minter」ドキュメントのフォーマットに従って作成されています。

---

## インターフェース

### `IYMT`:

- **説明**: YMT トークンのインターフェース。veYMT トークンはこのトークンを基にしています。
- **関数**:
  - トークンに関連する標準的な ERC20 関数群。

---

## イベント

### `CommitOwnership`:

- **説明**: 新しい管理者に所有権を委譲する際に発生します。
- **パラメータ**:
  - `admin`: 新しい管理者のアドレス。

### `ApplyOwnership`:

- **説明**: 所有権の移転が適用されたときにトリガーされるイベント。
- **パラメータ**:
  - `admin`: 新しい管理者のアドレス。

### `Deposit`:

- **説明**: ユーザーがトークンをデポジットした際に発生します。
- **パラメータ**:
  - `provider`: デポジットしたユーザーのアドレス。
  - `value`: デポジットされたトークンの量。
  - `locktime`: ロックされる時間。
  - `ts`: タイムスタンプ。

### `Withdraw`:

- **説明**: ユーザーがトークンを引き出した際に発生します。
- **パラメータ**:
  - `provider`: 引き出したユーザーのアドレス。
  - `value`: 引き出されたトークンの量。
  - `ts`: タイムスタンプ。

### `Supply`:

- **説明**: 供給量が変更されたときにトリガーされるイベント。
- **パラメータ**:
  - `prevSupply`: 変更前の供給量。
  - `supply`: 新しい供給量。

---

## 変数

### `locked: public(mapping(address => LockedBalance))`

- **説明**: ユーザーごとのロックされたバランスを記録します。

### `epoch: public(uint256)`

- **説明**: 現在のエポック番号。

### `token: public(address)`

- **説明**: veYMT トークンが基づいている YMT トークンのアドレス。

### `supply: public(uint256)`

- **説明**: 総供給量。

---

## 関数

### `constructor(tokenAddr_: address)`

- **説明**: コントラクトのコンストラクタ。YMT トークンのアドレスを設定します。
- **パラメータ**:
  - `tokenAddr_`: YMT トークンのアドレス。

### `commitTransferOwnership(addr_: address)`

- **説明**: 新しい管理者に所有権を委譲します。
- **パラメータ**:
  - `addr_`: 新しい管理者のアドレス。
- **アクセス制限**: 管理者のみ。

### `applyTransferOwnership()`

- **説明**: 所有権の移転を適用します。
- **アクセス制限**: 管理者のみ。

### `depositFor(addr_: address, value_: uint256)`

- **説明**: 指定したアドレスのユーザーのためにトークンをデポジットし、ロックします。
- **パラメータ**:
  - `addr_`: トークンをデポジットするユーザーのアドレス。
  - `value_`: デポジットするトークンの量。

### `createLock(value_: uint256, unlockTime_: uint256)`

- **説明**: 新しいロックを作成し、トークンをデポジットします。
- **パラメータ**:
  - `value_`: デポジットするトークンの量。
  - `unlockTime_`: トークンのロックを解除する時間（エポック秒）。

### `increaseAmount(value_: uint256)`

- **説明**: 既存のロックにトークンを追加します。
- **パラメータ**:
  - `value_`: 追加するトークンの量。

### `increaseUnlockTime(unlockTime_: uint256)`

- **説明**: ロックの解除時間を延長します。
- **パラメータ**:
  - `unlockTime_`: 新しいロック解除時間（エポック秒）。

### `withdraw()`

- **説明**: ロックが解除されたトークンを引き出します。

以下は、提供された Solidity コード「veYMT Token」の追加的なドキュメント記述です。このセクションは、コントラクトの仕様をより深く理解するのに役立ちます。

---

## コントラクトの詳細

### veYMT コントラクト:

- **目的**: veYMT コントラクトは、YMT トークンをロックして、ロック期間に応じた投票権を提供する機能を実装しています。ロックされたトークンは、所定の期間が経過するまで引き出すことができません。

### ロックメカニズム:

- **ロックの仕組み**: ユーザーは YMT トークンを veYMT コントラクトに預けることで、ロックされたトークンに基づく投票権を獲得します。ロック期間はユーザーによって設定され、最大で 4 年間です。
  veYMT トークンにおける投票権の変化は、ロックされたトークンの量とロック期間に基づいて計算されます。この計算には「バイアス」と「スロープ」という二つの概念が関係します。

### バイアスとスロープ

- **バイアス (Bias)**: ある時点でのユーザーの投票権の量を示します。これは、ロックされたトークンの量とロック期間に比例します。
- **スロープ (Slope)**: バイアスが時間とともにどのように減少するかを示す値です。これは、ロックされたトークンの量に依存し、ロック期間が経過するにつれて減少します。

## 投票権の計算

投票権の計算においては、次の数式が用いられます:

$$ \text{バイアス} = \text{スロープ} \times (\text{ロック終了時刻} - \text{現在時刻}) $$

ここで、

- **ロック終了時刻**: ユーザーが設定したトークンのロックが解除される時刻。
- **現在時刻**: 現在の時刻。

### 例

例えば、ユーザーが 100 veYMT トークンを 4 年間ロックするとします。この場合、スロープはロック量を最大ロック期間で割った値になります。

$$ \text{スロープ} = \frac{100 \text{ veYMT}}{4 \times 365 \times 24 \times 3600 \text{ 秒}} $$

ロックが開始された時点でのバイアスは、スロープにロック期間を掛けたものに等しくなります。したがって、バイアスは初め 100 veYMT となりますが、時間が経過するにつれて徐々に減少していきます。

### ロック期間の影響

- **長期ロックの利点**: 長期にわたってトークンをロックするほど、初期のバイアスは大きくなり、投票権の量も多くなります。
- **時間経過とともの減少**: しかし、時間が経過するにつれて、スロープによりバイアスは減少し、投票権も徐々に減少していきます。

このように veYMT トークンでは、ロック期間が長いほど、初期の投票権は多くなりますが、その権利は時間とともに減少していきます。このメカニズムにより、ユーザーは長期的なコミットメントを通じてより大きな投票権を得ることができますが、ロック期間が経過するにつれてその影響力は減少していきます。

### ユーザーインタラクション:

- **デポジット**: ユーザーは特定の量の YMT トークンをデポジットし、特定の期間でロックすることができます。
- **ロックの増加**: ユーザーは既存のロックにトークンを追加するか、ロック期間を延長することが可能です。
- **引き出し**: ロック期間が終了した後、ユーザーはロックされたトークンを引き出すことができます。
